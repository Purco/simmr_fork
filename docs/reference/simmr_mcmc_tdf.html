<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Estimate correction factors from stable isotope data with known dietary
proportions — simmr_mcmc_tdf • simmr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate correction factors from stable isotope data with known dietary
proportions — simmr_mcmc_tdf"><meta property="og:description" content="This function runs a slightly different version of the main
simmr_mcmc function with the key difference that it estimates
the correction factors (sometimes called trophic enrichment or trophic
discrimination factors; TEFs/TDFs) for a given set of dietary proportions."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simmr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/simmr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/advanced_plotting.html">simmr: advanced plotting guide</a>
    </li>
    <li>
      <a href="../articles/quick_start.html">simmr: quick start guide</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/andrewcparnell/simmr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimate correction factors from stable isotope data with known dietary
proportions</h1>
    <small class="dont-index">Source: <a href="https://github.com/andrewcparnell/simmr/blob/HEAD/R/simmr_mcmc_tdf.R" class="external-link"><code>R/simmr_mcmc_tdf.R</code></a></small>
    <div class="hidden name"><code>simmr_mcmc_tdf.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function runs a slightly different version of the main
<code><a href="simmr_mcmc.html">simmr_mcmc</a></code> function with the key difference that it estimates
the correction factors (sometimes called trophic enrichment or trophic
discrimination factors; TEFs/TDFs) for a given set of dietary proportions.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simmr_mcmc_tdf</span><span class="op">(</span></span>
<span>  <span class="va">simmr_in</span>,</span>
<span>  p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">simmr_in</span><span class="op">$</span><span class="va">n_sources</span>, <span class="va">simmr_in</span><span class="op">$</span><span class="va">n_sources</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">simmr_in</span><span class="op">$</span><span class="va">n_sources</span>,</span>
<span>    nrow <span class="op">=</span> <span class="va">simmr_in</span><span class="op">$</span><span class="va">n_obs</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  prior_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>c_mean_est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="va">simmr_in</span><span class="op">$</span><span class="va">n_tracers</span><span class="op">)</span>, c_sd_est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>,</span>
<span>    <span class="va">simmr_in</span><span class="op">$</span><span class="va">n_tracers</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mcmc_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>iter <span class="op">=</span> <span class="fl">10000</span>, burn <span class="op">=</span> <span class="fl">1000</span>, thin <span class="op">=</span> <span class="fl">10</span>, n.chain <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>simmr_in</dt>
<dd><p>An object created via the function <code><a href="simmr_load.html">simmr_load</a></code></p></dd>


<dt>p</dt>
<dd><p>The known dietary proportions for the feeding study. Dietary proportions should be given per individual (even if they are all identical)</p></dd>


<dt>prior_control</dt>
<dd><p>A list of values including arguments named <code>means</code>
and <code>sd</code> which represent the prior means and standard deviations of the
correction factors. These can usually be left at their default values unless
you wish to include to include prior information on them.</p></dd>


<dt>mcmc_control</dt>
<dd><p>A list of values including arguments named <code>iter</code>
(number of iterations), <code>burn</code> (size of burn-in), <code>thin</code> (amount
of thinning), and <code>n.chain</code> (number of MCMC chains).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class <code>simmr_tdf</code> with two named top-level
components:</p>
<dl><dt>input</dt>
<dd><p>The <code>simmr_input</code> object given to the
<code>simmr_mcmc</code> function</p></dd>

<dt>output</dt>
<dd><p>A set of MCMC chains of class
<code>mcmc.list</code> from the coda package. These can be analysed using
<code><a href="summary.simmr_output_tdf.html">summary.simmr_output_tdf</a></code></p></dd>
</dl><p>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The idea is that this code can be used for feeding studies where an
organism is fed a known proportional diet with a view to estimating
the correction factors to be used in a later stable isotope mixing
model when the organisms are observed in the field.</p>
<p>The main argument of the function is an object created from
<code><a href="simmr_load.html">simmr_load</a></code> which contains mixture data on a number of tracers
and food source means and standard deviations. Any correction factors
included in this object will be ignored. The known dietary proportions should be provided for each individual (i.e. should be a matrix with the same number of rows as <code>mix</code>). It is advisable to have multiple different dietary proportion values as part of the feeding experimental design</p>
<p>The output of the function is a posterior distribution on the correction
factors for each food source. Just like the output from
<code><a href="simmr_mcmc.html">simmr_mcmc</a></code>, this should be checked for convergence. Examples
are included below to help assist with this check and further plots</p>
<p>If, after running <code>simmr_mcmc_tdf</code> the convergence diagnostics in
<code><a href="summary.simmr_output_tdf.html">summary.simmr_output_tdf</a></code> are not satisfactory, the values of
<code>iter</code>, <code>burn</code> and <code>thin</code> in <code>mcmc_control</code> should be
increased by e.g. a factor of 10.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Andrew C. Parnell, Donald L. Phillips, Stuart Bearhop, Brice X.
Semmens, Eric J. Ward, Jonathan W. Moore, Andrew L. Jackson, Jonathan Grey,
David J. Kelly, and Richard Inger. Bayesian stable isotope mixing models.
Environmetrics, 24(6):387–399, 2013.</p>
<p>Andrew C Parnell, Richard Inger, Stuart Bearhop, and Andrew L Jackson.
Source partitioning using stable isotopes: coping with too much variation.
PLoS ONE, 5(3):5, 2010.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="simmr_load.html">simmr_load</a></code> for creating objects suitable for this
function, <code><a href="simmr_mcmc.html">simmr_mcmc</a></code> for estimating dietary proportions,
<code><a href="plot.simmr_input.html">plot.simmr_input</a></code> for creating isospace plots,
<code><a href="summary.simmr_output_tdf.html">summary.simmr_output_tdf</a></code> for summarising output</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Andrew Parnell &lt;andrew.parnell@mu.ie&gt;</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## Example of estimating TDFs for a simple system with known dietary proportions</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Data set 1: 10 obs on 2 isos, 4 sources, with tefs and concdep</span></span></span>
<span class="r-in"><span><span class="co"># Assume p = c(0.25, 0.25, 0.25, 0.25)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">simmr_data_1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Load into simmr</span></span></span>
<span class="r-in"><span><span class="va">simmr_tdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">simmr_data_1</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="simmr_load.html">simmr_load</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    mixtures <span class="op">=</span> <span class="va">mixtures</span>,</span></span>
<span class="r-in"><span>    source_names <span class="op">=</span> <span class="va">source_names</span>,</span></span>
<span class="r-in"><span>    source_means <span class="op">=</span> <span class="va">source_means</span>,</span></span>
<span class="r-in"><span>    source_sds <span class="op">=</span> <span class="va">source_sds</span>,</span></span>
<span class="r-in"><span>    correction_means <span class="op">=</span> <span class="va">correction_means</span>,</span></span>
<span class="r-in"><span>    correction_sds <span class="op">=</span> <span class="va">correction_sds</span>,</span></span>
<span class="r-in"><span>    concentration_means <span class="op">=</span> <span class="va">concentration_means</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simmr_tdf</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># MCMC run</span></span></span>
<span class="r-in"><span><span class="va">simmr_tdf_out</span> <span class="op">&lt;-</span> <span class="fu">simmr_mcmc_tdf</span><span class="op">(</span><span class="va">simmr_tdf</span>,</span></span>
<span class="r-in"><span>  p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="fl">1</span> <span class="op">/</span> <span class="va">simmr_tdf</span><span class="op">$</span><span class="va">n_sources</span>,</span></span>
<span class="r-in"><span>      <span class="va">simmr_tdf</span><span class="op">$</span><span class="va">n_sources</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    ncol <span class="op">=</span> <span class="va">simmr_tdf</span><span class="op">$</span><span class="va">n_sources</span>,</span></span>
<span class="r-in"><span>    nrow <span class="op">=</span> <span class="va">simmr_tdf</span><span class="op">$</span><span class="va">n_obs</span>,</span></span>
<span class="r-in"><span>    byrow <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Summary</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simmr_tdf_out</span>, type <span class="op">=</span> <span class="st">"diagnostics"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simmr_tdf_out</span>, type <span class="op">=</span> <span class="st">"quantiles"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now put these corrections back into the model and check the</span></span></span>
<span class="r-in"><span><span class="co"># iso-space plots and dietary output</span></span></span>
<span class="r-in"><span><span class="va">simmr_tdf_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">simmr_data_1</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="simmr_load.html">simmr_load</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    mixtures <span class="op">=</span> <span class="va">mixtures</span>,</span></span>
<span class="r-in"><span>    source_names <span class="op">=</span> <span class="va">source_names</span>,</span></span>
<span class="r-in"><span>    source_means <span class="op">=</span> <span class="va">source_means</span>,</span></span>
<span class="r-in"><span>    source_sds <span class="op">=</span> <span class="va">source_sds</span>,</span></span>
<span class="r-in"><span>    correction_means <span class="op">=</span> <span class="va">simmr_tdf_out</span><span class="op">$</span><span class="va">c_mean_est</span>,</span></span>
<span class="r-in"><span>    correction_sds <span class="op">=</span> <span class="va">simmr_tdf_out</span><span class="op">$</span><span class="va">c_sd_est</span>,</span></span>
<span class="r-in"><span>    concentration_means <span class="op">=</span> <span class="va">concentration_means</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot with corrections now</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simmr_tdf_2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">simmr_tdf_2_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="simmr_mcmc.html">simmr_mcmc</a></span><span class="op">(</span><span class="va">simmr_tdf_2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simmr_tdf_2_out</span>, type <span class="op">=</span> <span class="st">"diagnostics"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simmr_tdf_2_out</span>, type <span class="op">=</span> <span class="st">"boxplot"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Andrew Parnell, Emma Govan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

